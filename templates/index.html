<!DOCTYPE html>
<html>
<head>
  <title>ðŸŒ± Greenhouse Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
 <div class="container mt-4">
  <div class="row">
    <div class="col-md-4">
      <div class="card p-3 mb-3 text-center">
        <h5>Temperature</h5>
        <p id="tempValue">-- Â°C</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 mb-3 text-center">
        <h5>Humidity</h5>
        <p id="humidityValue">-- %</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card p-3 mb-3 text-center">
        <h5>Light</h5>
        <p id="lightValue">-- lux</p>
      </div>
    </div>
  </div>
  <div class="row">
    <canvas id="tempChart"></canvas>
    <canvas id="humidityChart"></canvas>
    <canvas id="lightChart"></canvas>
  </div>
</div>


  <script>
  
  const labels = [];
  const tempData = [];
  const humidityData = [];
  const lightData = [];

  const tempChart = new Chart(document.getElementById('tempChart').getContext('2d'), {
    type: 'line',
    data: { labels, datasets: [{ label: 'Temperature (Â°C)', data: tempData, borderColor: 'red', fill: false }] }
  });

  const humidityChart = new Chart(document.getElementById('humidityChart').getContext('2d'), {
    type: 'line',
    data: { labels, datasets: [{ label: 'Humidity (%)', data: humidityData, borderColor: 'blue', fill: false }] }
  });

  const lightChart = new Chart(document.getElementById('lightChart').getContext('2d'), {
    type: 'line',
    data: { labels, datasets: [{ label: 'Light (lux)', data: lightData, borderColor: 'orange', fill: false }] }
  });

  async function fetchData() {
    const res = await fetch('/data');
    return await res.json();
  }

  async function updateCharts() {
    const d = await fetchData();
    const now = new Date().toLocaleTimeString();

    // Update the cards
    document.getElementById("tempValue").innerText = d.temperature + " Â°C";
    document.getElementById("humidityValue").innerText = d.humidity + " %";
    document.getElementById("lightValue").innerText = d.light + " lux";

    // Keep last 20 points
    if (labels.length >= 20) {
      labels.shift();
      tempData.shift();
      humidityData.shift();
      lightData.shift();
    }

    labels.push(now);
    tempData.push(d.temperature);
    humidityData.push(d.humidity);
    lightData.push(d.light);

    tempChart.update();
    humidityChart.update();
    lightChart.update();
  }

  // Initial fetch + repeat every 10s
  updateCharts();
  setInterval(updateCharts, 10000);


</script>

</body>
</html>
