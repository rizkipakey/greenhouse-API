<!DOCTYPE html>
<html>
<head>
  <title>ğŸŒ± Greenhouse Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>ğŸŒ± Greenhouse Dashboard</h1>

  <canvas id="tempChart" width="400" height="150"></canvas>
  <canvas id="humidityChart" width="400" height="150"></canvas>
  <canvas id="lightChart" width="400" height="150"></canvas>

  <script>
    // Create empty datasets
    const labels = [];
    const tempData = [];
    const humidityData = [];
    const lightData = [];

    const tempChart = new Chart(document.getElementById('tempChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Temperature (Â°C)',
          data: tempData,
          borderColor: 'red',
          fill: false
        }]
      }
    });

    const humidityChart = new Chart(document.getElementById('humidityChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Humidity (%)',
          data: humidityData,
          borderColor: 'blue',
          fill: false
        }]
      }
    });

    const lightChart = new Chart(document.getElementById('lightChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Light (lux)',
          data: lightData,
          borderColor: 'orange',
          fill: false
        }]
      }
    });

    async function fetchData() {
      const res = await fetch('/data');
      return await res.json();
    }

    async function updateCharts() {
      const data = await fetchData();
      const now = new Date().toLocaleTimeString();

      // keep max 20 points
      if (labels.length >= 20) {
        labels.shift();
        tempData.shift();
        humidityData.shift();
        lightData.shift();
      }

      labels.push(now);
      tempData.push(data.temperature);
      humidityData.push(data.humidity);
      lightData.push(data.light);

      tempChart.update();
      humidityChart.update();
      lightChart.update();
    }

    // initial + repeat every 10s
    updateCharts();
    setInterval(updateCharts, 10000);
  </script>
</body>
</html>
